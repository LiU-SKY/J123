<body>
    <h1>BLE 기기 목록</h1>

    <form action="/submit/track" method="post">
        <label>드론 선택:
            <select name="drone_id">
                <option value="drone01">drone01</option>
            </select>
        </label>

        <div id="device-list">
            <!-- 여기에 BLE 목록이 동적으로 삽입됨 -->
        </div>

        <button type="submit">추적 시작</button>
    </form>

    <script>
        async function loadBLEList() {
            const response = await fetch("/api/ble_list");
            const data = await response.json();

            const listDiv = document.getElementById("device-list");
            listDiv.innerHTML = ""; // 기존 리스트 초기화

            if (data.length === 0) {
                listDiv.innerHTML = "<p>현재 BLE 기기 없음</p>";
                return;
            }

            for (const device of data) {
                const div = document.createElement("div");
                div.innerHTML = `
                    <label>
                        <input type="radio" name="mac_address" value="${device.mac_address}">
                        ${device.mac_address} - ${device.device_name}
                    </label>
                `;
                listDiv.appendChild(div);
            }
        }

        // 5초마다 갱신
        setInterval(loadBLEList, 5000);
        loadBLEList(); // 초기 로딩
    </script>
</body>
